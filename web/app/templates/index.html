{% extends "base.html" %}

{% block head %}

  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/loadingindicator.css') }}">
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/constraintslist.css') }}">
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/eventdescriptionslist.css') }}">
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/facet.css') }}">
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/timeline.css') }}">
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/compare.css') }}">
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/map.css') }}">
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/tsne.css') }}">
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/textsearch.css') }}">
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/storyline.css') }}">
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/main.css') }}">

  <script src="{{ url_for('static', filename='js/utils.js') }}"></script>
  <script src="{{ url_for('static', filename='js/layoututils.js') }}"></script>
  <script src="{{ url_for('static', filename='js/selections.js') }}"></script>
  <script src="{{ url_for('static', filename='js/d3utils.js') }}"></script>
  <script src="{{ url_for('static', filename='js/timeaxis.js') }}"></script>
  <script src="{{ url_for('static', filename='js/loadingindicator.js') }}"></script>
  <script src="{{ url_for('static', filename='js/queries.js') }}"></script>
  <script src="{{ url_for('static', filename='js/constraintslist.js') }}"></script>
  <script src="{{ url_for('static', filename='js/eventdescriptionslist.js') }}"></script>
  <script src="{{ url_for('static', filename='js/facet.js') }}"></script>
  <script src="{{ url_for('static', filename='js/timeline.js') }}"></script>
  <script src="{{ url_for('static', filename='js/compare.js') }}"></script>
  <script src="{{ url_for('static', filename='js/map.js') }}"></script>
  <script src="{{ url_for('static', filename='js/tsne.js') }}"></script>
  <script src="{{ url_for('static', filename='js/textsearch.js') }}"></script>
  <script src="{{ url_for('static', filename='js/storylinelayout.js') }}"></script>
  <script src="{{ url_for('static', filename='js/storyline.js') }}"></script>
  <script src="{{ url_for('static', filename='js/textreplacements.js') }}"></script>


  {% if config.DOMAIN == "wikipediahistory" %}

  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/wikipediahistory.css') }}">
  <script src="{{ url_for('static', filename='js/wikipediahistory.js') }}"></script>
  <script src="{{ url_for('static', filename='js/wikipediahistory_config_defaults.js') }}"></script>
  <script src="{{ url_for('static', filename='js/wikipediahistory_config_local.js') }}"></script>

  {% elif config.DOMAIN == "avherald" %}

  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/avherald.css') }}">
  <script src="{{ url_for('static', filename='js/avherald.js') }}"></script>
  <script src="{{ url_for('static', filename='js/avherald_config_defaults.js') }}"></script>
  <script src="{{ url_for('static', filename='js/avherald_config_local.js') }}"></script>

  {% else %}

  {% endif %}

  <script>
    FrontendConfig.backendUrl = "{{ config.BACKEND_URL }}";
  </script>

{% endblock %}


{% block content %}

{#
{% if g.user.is_authenticated() %}

Welcome back, {{ g.user.email }}!
<a href="{{ url_for("logout") }}">Log out</a>

{% else %}

<form action="" method="POST" name="login_form">
  {{ login_form.hidden_tag() }}
  {{ login_form.email(id="inputEmail", placeholder="Email") }}
  {{ login_form.password(id="inputPassword", placeholder="Password") }}
  <button type="submit" class="btn">Sign in</button>
  <a href="{{ url_for("register") }}">Register?</a>
</form>

{% endif %}
#}

<div class="header">
</div>

		<script>
			$('<div class="contentarea"> \
				<div class="sidebar"> \
					<div class="constraintslistbox"></div> \
					<div class="eventdescriptionslistbox"></div> \
				</div> \
				<div class="selectorsarea"> \
					<ul class="nav nav-pills" id="tabbar"> \
                      {% if "facets" in config.TABS %}
						<li class="active"><a href="#facetstab" data-toggle="tab" title="Facets view">Facets</a></li> \
                      {% endif %}
                      {% if "storyline" in config.TABS %}
						<li><a href="#storyline" data-toggle="tab" title="Storyline">Storyline</a></li> \
                      {% endif %}
                      {% if "timeline" in config.TABS %}
						<li><a href="#timelinetab" data-toggle="tab" title="Timeline view">Timeline</a></li> \
                      {% endif %}
                      {% if "comparison" in config.TABS %}
						<li><a href="#comparetab" data-toggle="tab" title="Comparison view">Comparison</a></li> \
                      {% endif %}
                      {% if "map" in config.TABS %}
						<li><a href="#maptab" data-toggle="tab" title="Map view">Map</a></li> \
                      {% endif %}
                      {% if "cluster" in config.TABS %}
						<li><a href="#tsnetab" data-toggle="tab" title="Cluster view">Cluster</a></li> \
                      {% endif %}
                      {% if "text" in config.TABS %}
						<li><a href="#textsearchtab" data-toggle="tab" title="Text search">Text search</a></li> \
                      {% endif %}
					</ul> \
					<div class="tab-content" id="tabcontents"> \
                      {% if "facets" in config.TABS %}
						<div class="tab-pane active" id="facetstab"></div> \
                      {% endif %}
                      {% if "storyline" in config.TABS %}
						<div class="tab-pane" id="storyline"></div> \
                      {% endif %}
                      {% if "timeline" in config.TABS %}
						<div class="tab-pane" id="timelinetab"></div> \
                      {% endif %}
                      {% if "comparison" in config.TABS %}
						<div class="tab-pane" id="comparetab"></div> \
                      {% endif %}
                      {% if "map" in config.TABS %}
						<div class="tab-pane" id="maptab"></div> \
                      {% endif %}
                      {% if "cluster" in config.TABS %}
						<div class="tab-pane" id="tsnetab"></div> \
                      {% endif %}
                      {% if "text" in config.TABS %}
						<div class="tab-pane" id="textsearchtab"></div> \
                      {% endif %}
					</div> \
				</div> \
			</div>').appendTo($('body'));

			LayoutUtils.setupPanelled($('body'), $('.header'), $('.contentarea'), 'vertical', 4);
			LayoutUtils.setupPanelled($('.selectorsarea'), $('#tabbar'), $('.tab-content'), 'vertical');

			var initialQuery = new Queries.Query(FrontendConfig.backendUrl);
			var globalQuery = new Queries.Query(FrontendConfig.backendUrl);

			function setupSidebar(container, globalQuery) {
				var cnstrBoxElt = $(".constraintslistbox");
				var eventDescBoxElt = $(".eventdescriptionslistbox");

				ConstraintsList.setup(cnstrBoxElt, globalQuery);
				EventDescriptionsList.setup(eventDescBoxElt, globalQuery);

				LayoutUtils.setupPanelled(container, cnstrBoxElt, eventDescBoxElt, 'vertical', 0, true);
			}
			setupSidebar($(".sidebar"), globalQuery);

			var fieldSelections = new Facet.FieldSelections(globalQuery);
			var facetsExpanded = [];
			var facetMakers = $.map(FrontendConfig.facets, function (facet) {
				return function (container) {
					fieldSelections.setName(facet.field, facet.title);
					facetsExpanded.push(Utils.extendObject([facet], {
						facet: Facet.setup(container, globalQuery, facet.title, facet.field, fieldSelections.get(facet.field))
					}));
				}
			});

            {% if "facets" in config.TABS %}
              LayoutUtils.setupSplitMakeElements($('#facetstab'), 'horizontal', facetMakers);
            {% endif %}
            {% if "storyline" in config.TABS %}
              Storyline.setup($('#storyline'), globalQuery, facetsExpanded, fieldSelections);
            {% endif %}
            {% if "timeline" in config.TABS %}
              Timeline.setup($('#timelinetab'), initialQuery, globalQuery);
            {% endif %}
            {% if "comparison" in config.TABS %}
              Compare.setup($('#comparetab'), globalQuery, facetsExpanded);
            {% endif %}
            {% if "map" in config.TABS %}
              Map.setup($('#maptab'), initialQuery, globalQuery, mapDataUrl, FrontendConfig.minMapZoom, FrontendConfig.maxMapZoom);
            {% endif %}
            {% if "cluster" in config.TABS %}
              Tsne.setup($('#tsnetab'), initialQuery, globalQuery, FrontendConfig.minMapZoom, FrontendConfig.maxMapZoom);
            {% endif %}
            {% if "text" in config.TABS %}
              TextSearch.setup($('#textsearchtab'), globalQuery);
            {% endif %}


            {% if "facets" in config.TABS %}
              LayoutUtils.fillElement($('.tab-content'), $('#facetstab'), 'vertical');
            {% endif %}
            {% if "storyline" in config.TABS %}
              LayoutUtils.fillElement($('.tab-content'), $('#storyline'), 'vertical');
            {% endif %}
            {% if "timeline" in config.TABS %}
              LayoutUtils.fillElement($('.tab-content'), $('#timelinetab'), 'vertical');
            {% endif %}
            {% if "comparison" in config.TABS %}
              LayoutUtils.fillElement($('.tab-content'), $('#comparetab'), 'vertical');
            {% endif %}
            {% if "map" in config.TABS %}
              LayoutUtils.fillElement($('.tab-content'), $('#maptab'), 'vertical');
            {% endif %}
            {% if "cluster" in config.TABS %}
              LayoutUtils.fillElement($('.tab-content'), $('#tsnetab'), 'vertical');
            {% endif %}
            {% if "text" in config.TABS %}
              LayoutUtils.fillElement($('.tab-content'), $('#textsearchtab'), 'vertical');
            {% endif %}

			LayoutUtils.fillElement($('.tab-content'), $('#abouttab'), 'vertical');

			// Update the queries only after setting up all the controls
			initialQuery.update();
			globalQuery.update();

			// Fake a window resize on changing tabs, so ensure that the contents are sized properly
			$('a[data-toggle="tab"]').on('shown', function () {
				$(window).trigger('resize');
			});
		</script>

{% endblock %}
