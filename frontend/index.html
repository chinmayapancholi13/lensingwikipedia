<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Lensing Wikipedia</title>
		<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
		<link rel="stylesheet" type="text/css" href="bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="bootstrap-responsive.min.css">
		<link rel="stylesheet" type="text/css" href="loadingindicator.css">
		<link rel="stylesheet" type="text/css" href="constraintslist.css">
		<link rel="stylesheet" type="text/css" href="eventdescriptionslist.css">
		<link rel="stylesheet" type="text/css" href="facet.css">
		<link rel="stylesheet" type="text/css" href="timeline.css">
		<link rel="stylesheet" type="text/css" href="map.css">
		<link rel="stylesheet" type="text/css" href="textsearch.css">
		<link rel="stylesheet" type="text/css" href="storyline.css">
		<link rel="stylesheet" type="text/css" href="main.css">
		<link rel="stylesheet" type="text/css" href="wikipediahistory.css">
	</head>
	<body>
		<div class="header">
			Lensing Wikipedia by <a target="_blank" href="http://natlang.cs.sfu.ca">SFU Natlang Lab</a>
			<a class="about" target="_blank" href="about.html">About</a>
		</div>
		<noscript>
			<p>
				This site really needs JavaScript!
			</p>
		</noscript>

		<script src="jquery.min.js"></script>
		<script src="jquery.cookie.min.js"></script>
		<script src="d3.v3.min.js"></script>
		<script src="topojson.v1.min.js"></script>
		<script src="d3.geo.projection.v0.min.js"></script>
		<script src="d3.geo.polyhedron.v0.min.js"></script>
		<script src="d3.sankey.min.js"></script>
		<script src="bootstrap.min.js"></script>
		<script src="utils.js"></script>
		<script src="layoututils.js"></script>
		<script src="d3utils.js"></script>
		<script src="timeaxisutils.js"></script>
		<script src="loadingindicator.js"></script>
		<script src="queries.js"></script>
		<script src="constraintslist.js"></script>
		<script src="eventdescriptionslist.js"></script>
		<script src="facet.js"></script>
		<script src="timeline.js"></script>
		<script src="map.js"></script>
		<script src="textsearch.js"></script>
		<script src="storyline.js"></script>
		<script src="descriptions.js"></script>
		<script src="wikipediahistory.js"></script>
		<script src="wikipediahistory_config_defaults.js"></script>
		<script src="frontendsettings.js"></script>

		<script>
			$("<div class=\"contentarea\"> \
				<div class=\"sidebar\"> \
					<div class=\"constraintslistbox\"></div> \
					<div class=\"eventdescriptionslistbox\"></div> \
				</div> \
				<div class=\"selectorsarea\"> \
					<ul class=\"nav nav-pills\" id=\"tabbar\"> \
						<li><a href=\"#facetstab\" data-toggle=\"tab\" title=\"Facets view\">Facets</a></li> \
						<li><a href=\"#timelinetab\" data-toggle=\"tab\" title=\"Timeline view\">Timeline</a></li> \
						<li><a href=\"#maptab\" data-toggle=\"tab\" title=\"Map view\">Map</a></li> \
						<li><a href=\"#textsearchtab\" data-toggle=\"tab\" title=\"Text search\">Text search</a></li> \
						<li class=\"active\"><a href=\"#storyline\" data-toggle=\"tab\" title=\"Storyline\">Storyline</a></li> \
					</ul> \
					<div class=\"tab-content\" id=\"tabcontents\"> \
						<div class=\"tab-pane\" id=\"facetstab\"></div> \
						<div class=\"tab-pane\" id=\"timelinetab\"></div> \
						<div class=\"tab-pane\" id=\"maptab\"></div> \
						<div class=\"tab-pane\" id=\"textsearchtab\"></div> \
						<div class=\"tab-pane active\" id=\"storyline\"></div> \
					</div> \
				</div> \
			</div>").appendTo($('body'));

			setupPanelled($('body'), $('.header'), $('.contentarea'), 'vertical', 4);
			setupPanelled($('.selectorsarea'), $('#tabbar'), $('.tab-content'), 'vertical');

			var initialQuery = new Query(backendUrl);
			var globalQuery = new Query(backendUrl);

			function setupSidebar(container, globalQuery) {
				var cnstrBoxElt = $(".constraintslistbox");
				var eventDescBoxElt = $(".eventdescriptionslistbox");

				setupConstraintList(cnstrBoxElt, globalQuery);
				setupEventDescriptionsList(eventDescBoxElt, globalQuery);

				setupPanelled(container, cnstrBoxElt, eventDescBoxElt, 'vertical', 0, true);
			}
			setupSidebar($(".sidebar"), globalQuery);

			var facetsInfo = [];
			var facetMakers = $.map(facets, function (title, field) {
				return function (container) {
					var constraintsQuery = setupFacet(container, globalQuery, title, field);
					facetsInfo.push({
						title: title,
						field: field,
						constraintsQuery: constraintsQuery
					});
				}
			});
			setupSplitMakeElements($('#facetstab'), 'horizontal', facetMakers);
			setupTimeline($('#timelinetab'), initialQuery, globalQuery);
			setupMap($('#maptab'), initialQuery, globalQuery, mapDataUrl, minMapZoom, maxMapZoom);
			setupTextSearch($('#textsearchtab'), globalQuery);
			setupStoryline($('#storyline'), globalQuery, facetsInfo);

			fillElement($('.tab-content'), $('#facetstab'), 'vertical');
			fillElement($('.tab-content'), $('#timelinetab'), 'vertical');
			fillElement($('.tab-content'), $('#maptab'), 'vertical');
			fillElement($('.tab-content'), $('#textsearchtab'), 'vertical');
			fillElement($('.tab-content'), $('#storyline'), 'vertical');
			fillElement($('.tab-content'), $('#abouttab'), 'vertical');

			// Update the queries only after setting up all the controls
			initialQuery.update();
			globalQuery.update();

			// Fake a window resize on changing tabs, so ensure that the contents are sized properly
			$('a[data-toggle="tab"]').on('shown', function () {
				$(window).trigger('resize');
			});
		</script>
	</body>
</html>
