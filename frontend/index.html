<!DOCTYPE html>
<html>
	<head>
		<title>Lensing Wikipedia</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" type="text/css" href="lib/bootstrap/css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="lib/bootstrap/css/bootstrap-responsive.min.css">
		<link rel="stylesheet" type="text/css" href="loadingindicator.css">
		<link rel="stylesheet" type="text/css" href="constraintslist.css">
		<link rel="stylesheet" type="text/css" href="eventdescriptionslist.css">
		<link rel="stylesheet" type="text/css" href="facet.css">
		<link rel="stylesheet" type="text/css" href="timeline.css">
		<link rel="stylesheet" type="text/css" href="map.css">
		<link rel="stylesheet" type="text/css" href="main.css">
	</head>
	<body>
		<div class="header">
			Lensing Wikipedia by <a href="http://natlang.cs.sfu.ca">SFU Natlang Lab</a>
		</div>
		<div class="contentarea">
			<div class="sidebar">
				<div class="constraintslistbox"></div>
				<div class="eventdescriptionslistbox"></div>
			</div>
			<div class="selectorsarea">
				<ul class="nav nav-pills" id="tabbar">
					<li class="active"><a href="#facetstab" data-toggle="tab">Facets</a></li>
					<li><a href="#timelinetab" data-toggle="tab">Timeline</a></li>
					<li><a href="#maptab" data-toggle="tab">Map</a></li>
				</ul>
				<div class="tab-content">
					<div class="tab-pane active" id="facetstab"></div>
					<div class="tab-pane" id="timelinetab"></div>
					<div class="tab-pane" id="maptab"></div>
				</div>
			</div>
		</div>
		<!-- TODO: message on no javascript -->

		<script src="lib/jquery.min.js"></script>
		<script src="lib/jquery.cookie.min.js"></script>
		<script src="lib/bootstrap/js/bootstrap.min.js"></script>
		<script src="lib/d3/d3.v3.min.js"></script>
		<script src="lib/d3/d3.geo.projection.v0.min.js"" charset="utf-8"></script>
		<script src="lib/d3/d3.geo.polyhedron.v0.min.js"" charset="utf-8"></script>
		<script src="lib/d3/topojson.v0.min.js" charset="utf-8"></script>

		<script src="config.js"></script>
		<script src="queries.js"></script>

		<script src="layoututils.js"></script>
		<script src="d3utils.js"></script>

		<script src="loadingindicator.js"></script>
		<script src="constraintslist.js"></script>
		<script src="eventdescriptionslist.js"></script>
		<script src="facet.js"></script>
		<script src="timeline.js"></script>
		<script src="map.js"></script>

		<script>
			setupPanelled($('body'), $('.header'), $('.contentarea'), 'vertical', 4);
			setupPanelled($('.selectorsarea'), $('#tabbar'), $('.tab-content'), 'vertical');

			function setupSidebar(container, globalQuery) {
				var cnstrBoxElt = $(".constraintslistbox");
				var eventDescBoxElt = $(".eventdescriptionslistbox");

				setupConstraintList(cnstrBoxElt, globalQuery);
				setupEventDescriptionsList(eventDescBoxElt, globalQuery);

				setupPanelled(container, cnstrBoxElt, eventDescBoxElt, 'vertical', 0, true);
			}

			var initialQuery = new Query(backendUrl);
			var globalQuery = new Query(backendUrl);
			setupSidebar($(".sidebar"), globalQuery);

			var facets = [
				function(container) {
					setupFacet(container, globalQuery, "Role (any arg)", "role");
				},
				function(container) {
					setupFacet(container, globalQuery, "Role (arg 0)", "roleA0");
				},
				function(container) {
					setupFacet(container, globalQuery, "Role (arg 1)", "roleA1");
				},
				function(container) {
					setupFacet(container, globalQuery, "Location", "locationText");
				}
			];
			fillElement($('.tab-content'), $('#facetstab'), 'vertical');
			fillElement($('.tab-content'), $('#timelinetab'), 'vertical');
			fillElement($('.tab-content'), $('#maptab'), 'vertical');
			setupSplitMakeElements($('#facetstab'), 'horizontal', facets);

			setupTimeline($('#timelinetab'), initialQuery, globalQuery);
			setupMap($('#maptab'), initialQuery, globalQuery, minMapZoom, maxMapZoom);

			initialQuery.update();
			globalQuery.update();

			// Fake a window resize on changing tabs, so ensure that the contents are sized properly
			$('a[data-toggle="tab"]').on('shown', function () {
				$(window).trigger('resize');
			});
		</script>
	</body>
</html>
