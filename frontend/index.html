<!DOCTYPE html>
<html>
	<head>
		<title>Lensing Wikipedia</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap-responsive.min.css">
		<link rel="stylesheet" type="text/css" href="loadingindicator.css">
		<link rel="stylesheet" type="text/css" href="constraintslist.css">
		<link rel="stylesheet" type="text/css" href="eventdescriptionslist.css">
		<link rel="stylesheet" type="text/css" href="facet.css">
		<link rel="stylesheet" type="text/css" href="timeline.css">
		<link rel="stylesheet" type="text/css" href="map.css">
		<link rel="stylesheet" type="text/css" href="main.css">
	</head>
	<body>
		<div class="header">
			Lensing Wikipedia by <a href="http://natlang.cs.sfu.ca">SFU Natlang Lab</a>
		</div>
		<div class="contentarea">
			<div class="sidebar">
				<div class="constraintslistbox"></div>
				<div class="eventdescriptionslistbox"></div>
			</div>
			<div class="selectorsarea">
				<ul class="nav nav-pills" id="tabbar">
					<li class="active"><a href="#facetstab" data-toggle="tab">Facets</a></li>
					<li><a href="#timelinetab" data-toggle="tab">Timeline</a></li>
					<li><a href="#maptab" data-toggle="tab">Map</a></li>
				</ul>
				<div class="tab-content">
					<div class="tab-pane active" id="facetstab"></div>
					<div class="tab-pane" id="timelinetab"></div>
					<div class="tab-pane" id="maptab"></div>
				</div>
			</div>
		</div>
		<!-- TODO: message on no javascript -->

		<!-- TODO: change to local js files for libraries -->
		<script src="http://code.jquery.com/jquery.js"></script>
		<script src="jquery.cookie.js"></script>
		<script src="bootstrap/js/bootstrap.min.js"></script>
		<script src="http://d3js.org/d3.v3.min.js"></script>
		<!-- TODO: do we need all of these? -->
		<script src="http://d3js.org/d3.v3.min.js"></script>
		<script src="http://d3js.org/d3.geo.projection.v0.js" charset="utf-8"></script>
		<script src="http://d3js.org/d3.geo.polyhedron.v0.min.js"" charset="utf-8"></script>
		<script src="http://d3js.org/topojson.v0.min.js" charset="utf-8"></script>

		<script src="config.js"></script>
		<script src="queries.js"></script>

		<script src="layoututils.js"></script>
		<script src="d3utils.js"></script>

		<script src="loadingindicator.js"></script>
		<script src="constraintslist.js"></script>
		<script src="eventdescriptionslist.js"></script>
		<script src="facet.js"></script>
		<script src="timeline.js"></script>
		<script src="map.js"></script>

		<script>
			setupPanelled($('body'), $('.header'), $('.contentarea'), 'vertical', 4);
			setupPanelled($('.selectorsarea'), $('#tabbar'), $('.tab-content'), 'vertical');

			function setupSidebar(container, globalQuery) {
				var cnstrBoxElt = $(".constraintslistbox");
				var eventDescBoxElt = $(".eventdescriptionslistbox");

				setupConstraintList(cnstrBoxElt, globalQuery);
				setupEventDescriptionsList(eventDescBoxElt, globalQuery);

				setupPanelled(container, cnstrBoxElt, eventDescBoxElt, 'vertical', 0, true);
			}

			var initialQuery = new Query(backendUrl);
			var globalQuery = new Query(backendUrl);
			setupSidebar($(".sidebar"), globalQuery);

			var facets = [
				function(container) {
					setupFacet(container, globalQuery, "Role (any arg)", {
						type: 'countbyrole'
					}, function makeConstraint(role) {
						return {
							type: 'role',
							role: role
						}
					});
				},
				function(container) {
					setupFacet(container, globalQuery, "Role (arg 0)", {
						type: 'countbyrole',
						arg: 0
					}, function makeConstraint(role) {
						return {
							type: 'role',
							arg: 0,
							role: role
						}
					});
				},
				function(container) {
					setupFacet(container, globalQuery, "Role (arg 1)", {
						type: 'countbyrole',
						arg: 1
					}, function makeConstraint(role) {
						return {
							type: 'role',
							arg: 1,
							role: role
						}
					});
				},
				function(container) {
					setupFacet(container, globalQuery, "Location", {
						type: 'countbylocation'
					}, function makeConstraint(location) {
						return {
							type: 'location',
							text: location
						}
					});
				}
			];
			fillElement($('.tab-content'), $('#facetstab'), 'vertical');
			fillElement($('.tab-content'), $('#timelinetab'), 'vertical');
			fillElement($('.tab-content'), $('#maptab'), 'vertical');
			setupSplitMakeElements($('#facetstab'), 'horizontal', facets);

			setupTimeline($('#timelinetab'), initialQuery, globalQuery);
/*
			setupMap($('#maptab'), initialQuery, globalQuery, minMapZoom, maxMapZoom);
*/

			initialQuery.update();
			globalQuery.update();

			// Fake a window resize on changing tabs, so ensure that the contents are sized properly
			$('a[data-toggle="tab"]').on('shown', function () {
				$(window).trigger('resize');
			});
		</script>
	</body>
</html>
